import{E as e}from"./index.js";const t=require("fs"),n=require("path"),i=n.resolve(),r=n.join(i,"../user/config"),o=n.join(i,"../user/config/userConfig.json");let a="";const s={language:"chinese",directDataLevelRule:"unified",autoSaveFile:!0,framed:!1,saveByDate:!0,newVersionTips:!0,autoCalcUnit:!0,theme:"light",autoUpdate:!0};function l(){if(t.existsSync(o)){return function(e){return Object.keys(s).forEach((t=>{void 0===e[t]&&(e[t]=s[t])})),e}(JSON.parse(t.readFileSync(o,"utf-8")))}{t.mkdirSync(r,{recursive:!0});const e=JSON.stringify(s);return t.writeFileSync(o,e,"utf-8"),s}}function c(e){const n=JSON.stringify(e,null,2);t.writeFileSync(o,n,"utf-8")}function u(e,r){if(0===e.directDataList.length&&0===e.indirectDataList.length&&""===a)return;const o=new Date,s=`${o.getFullYear()}-${(o.getMonth()+1).toString().padStart(2,"0")}-${o.getDate().toString().padStart(2,"0")}`,l=r.saveByDate?n.join(i,`../user/data/${s}`):n.join(i,"../user/data");t.existsSync(l)||t.mkdirSync(l,{recursive:!0});const c=`${function(e){let t="";const n=e.tableList.map((e=>e.tableTitleContent)),i=e.graphList.map((e=>e.graphTitleContent)),r=[...e.directDataList,...e.indirectDataList],o=n.concat(i).filter((e=>""!==e));if(o.length>0)for(let a=0;a<Math.min(o.length,8);a++)0!==a&&(t+="-"),t+=`${o[a]}`;else for(let a=0;a<Math.min(r.length,10);a++)0!==a&&(t+="-"),t+=`${r[a].title}`;return t.replace(/[<>:"/\\|?*]+/g,"_")}(e)}.json`,u=n.join(l,c),f=JSON.stringify(e,null,2);if(""===a)a=c,t.writeFileSync(u,f,"utf-8");else if(a!==c){const e=n.join(l,a);t.renameSync(e,u),a=c,t.writeFileSync(u,f,"utf-8")}else t.writeFileSync(u,f,"utf-8")}function f(t){const n=document.createElement("input");n.type="file",n.style.display="none",document.body.appendChild(n),n.click(),n.addEventListener("change",(function(i){const r=i.target.files[0];if(r&&"application/json"===r.type){console.log("Selected file:",r.name);const n=new FileReader;n.onload=n=>{try{const e=n.target.result,i=JSON.parse(e);for(const n in i)t[n]=i[n]}catch(i){e.error("读取文件过程出错！"),console.error("Error parsing JSON:",i)}},n.readAsText(r),i.target.value=""}else console.log("No file selected or file type is not supported."),alert("请上传一个 JSON 文件");document.body.removeChild(n)}))}export{f as openFile,l as readUserConfig,u as saveStateOnExit,c as saveUserConfig};
